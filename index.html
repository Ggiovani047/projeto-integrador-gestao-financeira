<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Análise Financeira & Contábil</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div class="container">
    <header>
        <h1>Dashboard de Gestão Financeira</h1>
        <p class="subtitle">Cálculo Modular de Ciclos, Ponto de Equilíbrio e Alavancagem</p>
    </header>

    <form id="financialForm">
        <div class="main-grid">
            <!-- Card Inputs Operacionais -->
            <div class="card">
                <h2>1. Dados Unitários e Custos</h2>
                <div class="form-group">
                    <label>Preço de Venda por Unidade</label>
                    <input type="text" id="price" inputmode="numeric" oninput="formatMoney(this)" placeholder="R$ 0,00">
                </div>
                <div class="form-group">
                    <label>Custo/Despesa Variável por Unidade</label>
                    <input type="text" id="vc" inputmode="numeric" oninput="formatMoney(this)" placeholder="R$ 0,00">
                </div>
                <div class="form-group">
                    <label>Custos e Despesas Fixas Totais</label>
                    <input type="text" id="fc" inputmode="numeric" oninput="formatMoney(this)" placeholder="R$ 0,00">
                </div>
                <div class="form-group">
                    <label>Quantidade Vendida Atual (Unidades)</label>
                    <!-- Mantido como number sem máscara -->
                    <input type="number" id="quantity" placeholder="Ex: 500">
                </div>
            </div>

            <!-- Card Inputs Capital de Giro -->
            <div class="card">
                <h2>
                    2. Dados de Capital de Giro
                    <button type="button" onclick="autoFillFromOp()" class="btn-sm" title="Calcula CMV e Receita baseado nos dados da seção 1">
                        Auto-preencher
                    </button>
                </h2>
                <div class="form-group">
                    <label>Estoque Médio</label>
                    <input type="text" id="inventory" inputmode="numeric" oninput="formatMoney(this)" placeholder="R$ 0,00">
                </div>
                <div class="form-group">
                    <label>Contas a Receber Médio</label>
                    <input type="text" id="receivables" inputmode="numeric" oninput="formatMoney(this)" placeholder="R$ 0,00">
                </div>
                <div class="form-group">
                    <label>Fornecedores Médio</label>
                    <input type="text" id="payables" inputmode="numeric" oninput="formatMoney(this)" placeholder="R$ 0,00">
                </div>
                <div class="form-group">
                    <label>Custo das Mercadorias Vendidas - CMV</label>
                    <input type="text" id="cogs" inputmode="numeric" oninput="formatMoney(this)" placeholder="Automático ou Manual">
                </div>
                <div class="form-group">
                    <label>Receita de Vendas Total</label>
                    <input type="text" id="revenue" inputmode="numeric" oninput="formatMoney(this)" placeholder="Automático ou Manual">
                </div>
            </div>
        </div>

        <button type="button" onclick="processCalculations()" class="btn-calc">Calcular Indicadores Disponíveis</button>
    </form>

    <hr style="margin: 40px 0; border-color: #e2e8f0;">

    <!-- Seção de Resultados (Inicialmente oculta) -->
    <div class="main-grid result-container" id="resultsSection">
        
        <!-- Card Resultados Operacionais -->
        <div class="card">
            <h2>Indicadores de Resultado</h2>
            
            <!-- Caixa de erro específica -->
            <div id="error-operational" class="error-box"></div>
            
            <div id="content-operational" class="data-content">
                <div class="result-item">
                    <span>Margem de Contribuição (Unitária):</span>
                    <span class="result-value highlight" id="res-mcu">-</span>
                </div>
                <div class="result-item">
                    <span>Margem de Contribuição (%):</span>
                    <span class="result-value" id="res-mc-percent">-</span>
                </div>
                <div class="result-item">
                    <span>Ponto de Equilíbrio (Qtd):</span>
                    <span class="result-value" id="res-pe-qtd">-</span>
                </div>
                <div class="result-item">
                    <span>Ponto de Equilíbrio (Valor):</span>
                    <span class="result-value" id="res-pe-val">-</span>
                </div>
                <div class="result-item">
                    <span>Grau de Alavancagem (GAO):</span>
                    <span class="result-value" id="res-gao">-</span>
                </div>
                <div class="result-item">
                    <span>Análise Marginal (Lucro Atual):</span>
                    <span class="result-value highlight" id="res-profit">-</span>
                </div>
            </div>
        </div>

        <!-- Card Resultados Ciclos -->
        <div class="card">
            <h2>Indicadores de Ciclos (Prazos)</h2>
            
            <!-- Caixa de erro específica -->
            <div id="error-cycles" class="error-box"></div>

            <div id="content-cycles" class="data-content">
                <div class="result-item">
                    <span>Prazo Médio de Estoque (PME):</span>
                    <span class="result-value" id="res-pme">-</span>
                </div>
                <div class="result-item">
                    <span>Prazo Médio de Recebimento (PMR):</span>
                    <span class="result-value" id="res-pmr">-</span>
                </div>
                <div class="result-item">
                    <span>Prazo Médio de Pagamento (PMP):</span>
                    <span class="result-value" id="res-pmp">-</span>
                </div>
                <div class="result-item" style="border-top: 2px dashed #cbd5e1; margin-top:10px;">
                    <span>Ciclo Operacional:</span>
                    <span class="result-value" id="res-co">-</span>
                </div>
                <div class="result-item">
                    <span>Ciclo de Conversão de Caixa (CCC):</span>
                    <span class="result-value highlight" id="res-ccc">-</span>
                </div>
                <p style="font-size: 0.8rem; color: #666; margin-top: 10px;">
                    *Cálculos baseados no ano comercial de 365 dias.
                </p>
            </div>
        </div>
        
        <!-- Card Gráfico -->
        <div class="card" style="grid-column: 1 / -1;">
            <h2>Análise Gráfica: Ponto de Equilíbrio</h2>
            <div id="error-chart" class="error-box"></div>
            <div class="chart-container" id="chart-wrapper">
                <canvas id="beChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="js/script.js"></script>

</body>
</html>