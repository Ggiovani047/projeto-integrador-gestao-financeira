<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Análise Financeira & Contábil</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <div class="container">
        <header>
            <h1>Dashboard de Gestão Financeira</h1>
            <p class="subtitle">Simulação Integrada de Performance Contábil</p>
        </header>

        <form id="formularioFinanceiro">
            <div class="main-grid">
                <!-- Card 1: Inputs Operacionais -->
                <div class="card">
                    <h2>
                        <svg class="icon-title" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z">
                            </path>
                        </svg>
                        1. Dados Operacionais
                    </h2>
                    <div class="form-group">
                        <label>Preço de Venda (Unitário)</label>
                        <input type="text" id="precoVendaUnitario" inputmode="numeric"
                            oninput="formatarMoedaAoDigitar(this)" placeholder="R$ 0,00">
                    </div>
                    <div class="form-group">
                        <label>Custo Variável (Unitário)</label>
                        <input type="text" id="custoVariavelUnitario" inputmode="numeric"
                            oninput="formatarMoedaAoDigitar(this)" placeholder="R$ 0,00">
                    </div>
                    <div class="form-group">
                        <label>Custos Fixos Totais</label>
                        <input type="text" id="custosFixosTotais" inputmode="numeric"
                            oninput="formatarMoedaAoDigitar(this)" placeholder="R$ 0,00">
                    </div>
                    <div class="form-group">
                        <label>Quantidade Vendida</label>
                        <input type="number" id="quantidadeVendida" placeholder="Ex: 500">
                    </div>
                </div>

                <!-- Card 2: Inputs Capital de Giro -->
                <div class="card">
                    <h2>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <svg class="icon-title" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            2. Capital de Giro
                        </div>
                        <button type="button" onclick="preencherAutomaticamenteDadosOperacionais()"
                            class="botao-pequeno" title="Calcula CMV e Receita baseado na Seção 1">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                            Auto-preencher
                        </button>
                    </h2>
                    <div class="form-group">
                        <label>Estoque Médio</label>
                        <input type="text" id="estoqueMedio" inputmode="numeric" oninput="formatarMoedaAoDigitar(this)"
                            placeholder="R$ 0,00">
                    </div>
                    <div class="form-group">
                        <label>Contas a Receber (Médio)</label>
                        <input type="text" id="contasReceberMedio" inputmode="numeric"
                            oninput="formatarMoedaAoDigitar(this)" placeholder="R$ 0,00">
                    </div>
                    <div class="form-group">
                        <label>Fornecedores (Médio)</label>
                        <input type="text" id="fornecedoresMedio" inputmode="numeric"
                            oninput="formatarMoedaAoDigitar(this)" placeholder="R$ 0,00">
                    </div>
                    <div class="form-group">
                        <label>CMV (Anual)</label>
                        <input type="text" id="custoMercadoriasVendidas" inputmode="numeric"
                            oninput="formatarMoedaAoDigitar(this)" placeholder="R$ 0,00">
                    </div>
                    <div class="form-group">
                        <label>Receita Total (Anual)</label>
                        <input type="text" id="receitaTotalAnual" inputmode="numeric"
                            oninput="formatarMoedaAoDigitar(this)" placeholder="R$ 0,00">
                    </div>
                </div>

                <!-- Card 3: Inputs Balanço -->
                <div class="card" style="grid-column: 1 / -1;">
                    <h2>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <svg class="icon-title" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                                </path>
                            </svg>
                            3. Balanço & Resultados
                        </div>
                        <button type="button" onclick="estimarDadosFinanceiros()" class="botao-pequeno"
                            title="Estima valores com base nos dados anteriores">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z">
                                </path>
                            </svg>
                            Estimar
                        </button>
                    </h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px;">
                        <div class="form-group">
                            <label>Ativo Circulante (Total)</label>
                            <input type="text" id="ativoCirculante" inputmode="numeric"
                                oninput="formatarMoedaAoDigitar(this)" placeholder="R$ 0,00">
                            <div class="tooltip-informativo">Estoque + Recebíveis + Caixa</div>
                        </div>
                        <div class="form-group">
                            <label>Passivo Circulante (Total)</label>
                            <input type="text" id="passivoCirculante" inputmode="numeric"
                                oninput="formatarMoedaAoDigitar(this)" placeholder="R$ 0,00">
                            <div class="tooltip-informativo">Fornecedores + Curto Prazo</div>
                        </div>
                        <div class="form-group">
                            <label>Ativo Total</label>
                            <input type="text" id="ativoTotal" inputmode="numeric"
                                oninput="formatarMoedaAoDigitar(this)" placeholder="R$ 0,00">
                        </div>
                        <div class="form-group">
                            <label>Patrimônio Líquido</label>
                            <input type="text" id="patrimonioLiquido" inputmode="numeric"
                                oninput="formatarMoedaAoDigitar(this)" placeholder="R$ 0,00">
                        </div>
                        <div class="form-group">
                            <label>Lucro Líquido (Final)</label>
                            <input type="text" id="lucroLiquido" inputmode="numeric"
                                oninput="formatarMoedaAoDigitar(this)" placeholder="R$ 0,00">
                            <div class="tooltip-informativo">Lucro Op. - Impostos</div>
                        </div>
                    </div>
                </div>
            </div>

            <button type="button" id="btnCalcular" onclick="iniciarCalculoComAnimacao()" class="botao-calcular">
                <span class="btn-text">Gerar Dashboard Analítico</span>
                <div class="spinner"></div>
            </button>
        </form>

        <hr style="margin: 60px 0; border-color: #e2e8f0; opacity: 0.5;">

        <!-- Seção de Resultados -->
        <div class="main-grid container-resultados" id="secaoResultados">

            <!-- Resultado 1: Operacional -->
            <div class="card card-resultado-oculto">
                <h2>Resultado Operacional</h2>
                <div id="caixaErroOperacional" class="caixa-erro"></div>
                <div id="conteudoOperacional" class="conteudo-dados">
                    <div class="item-resultado">
                        <span>Margem de Contribuição (Unit.):</span>
                        <span class="valor-resultado destaque" id="resultadoMargemContribuicaoUnitario">-</span>
                    </div>
                    <div class="item-resultado">
                        <span>Margem Contribuição (%):</span>
                        <span class="valor-resultado" id="resultadoMargemContribuicaoPercentual">-</span>
                    </div>
                    <div class="item-resultado">
                        <span>Ponto de Equilíbrio (Qtd):</span>
                        <span class="valor-resultado" id="resultadoPontoEquilibrioQuantidade">-</span>
                    </div>
                    <div class="item-resultado">
                        <span>Ponto de Equilíbrio (Valor):</span>
                        <span class="valor-resultado" id="resultadoPontoEquilibrioValor">-</span>
                    </div>
                    <div class="item-resultado">
                        <span>Alavancagem (GAO):</span>
                        <span class="valor-resultado" id="resultadoGrauAlavancagemOperacional">-</span>
                    </div>
                    <div class="item-resultado">
                        <span>Lucro Operacional (EBIT):</span>
                        <span class="valor-resultado destaque" id="resultadoLucroOperacional">-</span>
                    </div>
                </div>
            </div>

            <!-- Resultado 2: Ciclos -->
            <div class="card card-resultado-oculto">
                <h2>Prazos e Ciclos</h2>
                <div id="caixaErroCiclos" class="caixa-erro"></div>
                <div id="conteudoCiclos" class="conteudo-dados">
                    <div class="item-resultado">
                        <span>Prazo Médio Estoque:</span>
                        <span class="valor-resultado" id="resultadoPrazoMedioEstocagem">-</span>
                    </div>
                    <div class="item-resultado">
                        <span>Prazo Médio Recebim.:</span>
                        <span class="valor-resultado" id="resultadoPrazoMedioRecebimento">-</span>
                    </div>
                    <div class="item-resultado">
                        <span>Prazo Médio Pagto:</span>
                        <span class="valor-resultado" id="resultadoPrazoMedioPagamento">-</span>
                    </div>
                    <div class="item-resultado" style="border-top: 2px dashed #cbd5e1; margin-top:10px;">
                        <span>Ciclo Operacional:</span>
                        <span class="valor-resultado" id="resultadoCicloOperacional">-</span>
                    </div>
                    <div class="item-resultado">
                        <span>Ciclo de Conversão de Caixa:</span>
                        <span class="valor-resultado destaque" id="resultadoCicloConversaoCaixa">-</span>
                    </div>
                </div>
            </div>

            <!-- Resultado 3: Indicadores Financeiros -->
            <div class="card card-resultado-oculto" style="grid-column: 1 / -1;">
                <h2>Indicadores Financeiros</h2>
                <div id="caixaErroFinanceiro" class="caixa-erro"></div>
                <div id="conteudoFinanceiro" class="conteudo-dados"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 40px;">
                    <div>
                        <div class="item-resultado">
                            <span title="Ativo Circulante / Passivo Circulante">Liquidez Corrente:</span>
                            <span class="valor-resultado" id="resultadoLiquidezCorrente">-</span>
                        </div>
                        <div class="item-resultado">
                            <span title="(Ativo Circulante - Estoque) / Passivo Circulante">Liquidez Seca:</span>
                            <span class="valor-resultado" id="resultadoLiquidezSeca">-</span>
                        </div>
                    </div>
                    <div>
                        <div class="item-resultado">
                            <span title="Lucro Líquido / Receita Total">Margem Líquida:</span>
                            <span class="valor-resultado" id="resultadoMargemLiquida">-</span>
                        </div>
                        <div class="item-resultado">
                            <span title="Lucro Líquido / Patrimônio Líquido">ROE (Retorno s/ PL):</span>
                            <span class="valor-resultado destaque" id="resultadoRetornoSobrePatrimonio">-</span>
                        </div>
                    </div>
                    <div>
                        <div class="item-resultado">
                            <span title="Lucro Líquido / Ativo Total">ROA (Retorno s/ Ativo):</span>
                            <span class="valor-resultado" id="resultadoRetornoSobreAtivo">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gráfico -->
            <div class="card card-resultado-oculto" style="grid-column: 1 / -1;">
                <h2>Análise Gráfica: Ponto de Equilíbrio</h2>
                <div id="caixaErroGrafico" class="caixa-erro"></div>
                <div class="container-grafico" id="containerGrafico">
                    <canvas id="graficoPontoEquilibrio"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="js/script.js"></script>

</body>

</html>